# 🚀 실행 컨텍스트 🚀

- 실행할 코드에 관한 환경 정보들을 모아놓은 객체
- JS는 실행컨텍스트를 콜스택에 쌓아올린 후 실행하여 코드의 환경과 순서를 보장 할 수 있게 된다.
- 변수, 함수, 개체 및 프로그램 상태를 포함하여 코드를 실행하는데 필요한 모든 것이 포함

![IMG_0097](https://gamguma.dev/_next/image?url=%2F2022%2F04%2Fjs_execution_context%2Fimages%2Fcontext_example.png&w=1920&q=75)

- 처음 JS코드를 실행하는 순간 (1)처럼 전역 컨텍스트가 콜스택에 담긴다.
- 브라우저의 경우 `window`, node 환경의 경우 `global` 같은 객체를 사용할 수 있는 이유

### 콜스택

- 실행스택 또는 호출 스택이라고도 불리우며 함수의 실행 순서를 추적하는 데이터 구조
  <br/> 함수가 호출될 때마다 새로운 실행 컨텍스트가 생성되어 스택에 푸시된다.
  <br/> 함수가 완료되면 실행 컨텍스트가 스택에서 제거되고 프로그램이 중단된 지점부터 다시 시작
- 콜 스택은 LIFO(후입선출) 원칙을 따른다. 즉 가장 최근에 추가된 실행 컨텍스트가 가장 먼저 제거

1. 콜스택엔 전역 컨텍스트를 제외하곤 다른 컨텍스트가 없기에 전역 컨텍스트와 관련된 코드를 진행합니다.
2. 전역 컨텍스트와 관련된 코드를 진행 중 a함수를 실행하였기에 a 함수의 환경 정보들을 수집하여 a 실행 컨텍스트를 생성, 콜스택에 담습니다.<br>
   콜스택 최상단에 a 실행 컨텍스트가 있기에 기존의 전역 컨텍스트와 관련된 코드의 실행을 일시적으로 중단한 후 a 실행 컨텍스트의 코드를 실행합니다.
3. a 함수 내부에서 b 함수를 실행하였기에 b 함수의 환경 정보들을 수집, 실행 컨텍스트를 생성, 콜스택에 담습니다. <br>
   이전과 똑같이 콜스택 최상단에 b 실행 컨텍스트가 있기에 기존 a 실행 컨텍스트와 관련된 코드의 실행을 일시적 중단합니다.
4. b 함수가 종료된 후 b 실행 컨텍스트가 콜스택에서 제거됩니다. 제거 후 콜스택 최상단에는 a 실행 컨텍스트가 있기에 이전에 중단된 지점부터 코드 진행이 재개됩니다.
5. a 함수 또한 종료된 후 실행 컨텍스트가 콜스택에서 제거됩니다.
6. 이후엔 전역 공간에 실행할 코드가 남아있지 않다면 콜스택에서 전역 컨텍스트 또한 제거되며 콜스택에 아무 것도 남지 않은 상태로 종료됩니다.

   <br>

# 실행 컨텍스트에는 세가지 주요 구성 요소가 있다.

### Variable Environment

- 이 구성 요소는 현재 범위 내에서 선언된 모든 변수와 함수를 저장
- 변수나 함수를 정의하면 실행 컨텍스트의 변수 환경에서 저장
- 이를 통해 코드는 다음에 변수와 함수에 액세스하고 사용할 수 있음
- 여기에는 var, let, const 키워드와 함수 선언으로 생성된 변수가 포함

### Scope Chain

- 현재 실행 컨텍스트 및 상위 컨텍스트에서 사용 가능한 모든 변수 환경의 목록
- 변수를 참조 할 때 JS엔진은 현재 범위에서 변수를 검색한 다음 변수를 찾거나 전역 범위에 도달할 때까지 범위 체인을 탐색

### this 값

- this 값은 현재 코드가 실행되고 있는 개체를 나타냄, 즉 함수가 호출되는 컨텍스트를 나타낸다.
- this 값은 일반 함수호출, 메서드 호출 또는 생성자 호출과 같이 함수가 호출되는 방식에 따라 달라질 수 있다.

  <br>

# 실행 컨텍스트 속엔 어떤 정보가 있을까?

### Variabel Environment

- Variabel Environment란 현재 컨텍스트 내부의 식별자 정보 `environmentRecord`, 외부 환경정보 `outerEnvironmentReference`가 포함되어 있다.
- VariableEnvironment 에 먼저 정보를 담고, 그대로 LexicalEnvironment 에 복사해 사용한다고 합니다.
- 여기에는 변수, 함수 선언 및 함수 인수가 포함됩니다. 변수 환경은 코드가 실행되기 전에 설정됩니다.

### LexicalEnvironment

- VariableEnvironment 초기 상태를 기억하고 있으며, LexicalEnvironment 최신 상태를 저장하고 있습니다.
- VariableEnvironment는 변수 환경과 유사하며 변수 및 함수 선언을 포함합니다. <br/> 그러나 범위 체인 생성을 허용하는 현재 범위의 외부 환경 참조도 포함됩니다.
- LexicalEnvironment는 함수 생성 시 설정됩니다.

### environmentRecord

- environmentRecord 란 현재 컨텍스트와 관련된 식별자와 식별자에 바인딩된 값이 기록되는 공간입니다.
  더불어 실행 컨텍스트 내부 전체를 처음부터 끝까지 확인하며 순서대로 수집합니다.

# 실행 컨텍스트가 활성화 되는 시점

- 호이스팅이 발생한다.(선언된 변수를 위로 끌어올린다.)
- 외부 환경 정보를 구성한다.
- this값을 설정한다

<br>

```javascript
var a = 1; // 전역 컨텍스트
function outer() {
  // outer 컨텍스트
  function inner() {
    // inner 컨텍스트
    console.log(a); // undefined
    var a = 3;
    console.log(a); // 3
  }
  inner();
  console.log(a); // 1
}
outer();
console.log(a); // 1
```

- 위와 같이 코드를 구성했을 때 실행 컨텍스트의 스택은 다음과 같은 순서로 실행된다.
  1. 프로그램 실행: [전역컨텍스트]
  2. outer 실행: [전역컨텍스트, outer]
  3. inner 실행: [전역컨텍스트, outer, inner]
  4. inner 종료: [전역컨텍스트, outer]
  5. outer 종료: [전역컨텍스트]

### 실행 컨텍스트가 구성되는 코드들은 다음과 같다

- 전역 코드
- eval 코드
- 함수 코드
- 모듈 코드

<br>

## 1. 구조

- JS엔진은 실행 컨텍스트의 추상화된 정보들을 물리적 개체 형태로 관리

=== 추가 내용 ===

` 실행컨텍스트를 이해하는 것은 변수 범위 지정방법, 함수 호출 해결방법 및 JS에서 this키워드가 작동하는 방법을 이해하는 데 필수적`
